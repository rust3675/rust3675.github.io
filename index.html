<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detailed 3D Running Alpaca (ESM)</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #ADD8E6;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        #canvas-container {
            width: 100%;
            height: 100vh;
            display: block;
        }
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
            pointer-events: none;
            transition: opacity 0.5s;
        }
        .controls-info {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.8);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            pointer-events: none;
            user-select: none;
            max-width: 250px;
        }
        h1 {
            margin: 0 0 5px 0;
            font-size: 18px;
            color: #333;
        }
        p {
            margin: 0;
            font-size: 14px;
            color: #666;
        }
    </style>
</head>
<body>

    <div id="canvas-container"></div>
    <div id="loading">åŠ è½½ä¸­...</div>
    <div class="controls-info">
        <h1>ç²¾ç»†åŒ–ç¾Šé©¼ (Detailed Alpaca)</h1>
        <p>ğŸ–±ï¸ å·¦é”®æ‹–æ‹½ï¼šæ—‹è½¬è§†è§’</p>
        <p>ğŸ–±ï¸ å³é”®æ‹–æ‹½ï¼šå¹³ç§»è§†è§’</p>
        <p>ğŸ–±ï¸ æ»šè½®ï¼šç¼©æ”¾</p>
    </div>

    <!-- ä½¿ç”¨ Import Map æ–¹å¼å¼•å…¥æ¨¡å—ï¼Œè¿™æ˜¯ç°ä»£ Three.js çš„æ ‡å‡†åšæ³•ï¼Œå½»åº•è§£å†³ä¾èµ–é—®é¢˜ -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.146.0/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.146.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // --- åœºæ™¯åˆå§‹åŒ– ---
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        scene.fog = new THREE.Fog(0xADD8E6, 20, 100); 

        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(10, 10, 15);
        camera.lookAt(0, 0, 0);

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        container.appendChild(renderer.domElement);

        // --- æ§åˆ¶å™¨ ---
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.minDistance = 5;
        controls.maxDistance = 50;

        // --- ç¯å…‰ ---
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
        scene.add(ambientLight);

        const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
        dirLight.position.set(15, 25, 15);
        dirLight.castShadow = true;
        dirLight.shadow.mapSize.width = 2048;
        dirLight.shadow.mapSize.height = 2048;
        dirLight.shadow.camera.near = 0.5;
        dirLight.shadow.camera.far = 70;
        dirLight.shadow.bias = -0.001;
        scene.add(dirLight);

        // --- æè´¨ ---
        const furColor = 0xF8F8E7; 
        const furMaterial = new THREE.MeshStandardMaterial({ 
            color: furColor, 
            roughness: 0.8,
            metalness: 0.1
        });
        
        const skinColor = 0xC0846A; 
        const skinMaterial = new THREE.MeshStandardMaterial({
            color: skinColor,
            roughness: 0.7,
            metalness: 0.1
        });

        const eyeMaterial = new THREE.MeshStandardMaterial({ color: 0x1A1A1A });

        // --- åˆ›å»ºç¾Šé©¼æ¨¡å‹ ---
        const alpaca = new THREE.Group();
        alpaca.position.y = 1.0; 

        // 1. èº«ä½“ (Body)
        const bodyPart1Geo = new THREE.CapsuleGeometry(1.5, 3, 10, 20);
        const bodyPart1 = new THREE.Mesh(bodyPart1Geo, furMaterial);
        bodyPart1.rotation.z = Math.PI / 2; 
        bodyPart1.position.z = -0.5;
        bodyPart1.castShadow = true;
        bodyPart1.receiveShadow = true;
        alpaca.add(bodyPart1);

        const bodyPart2Geo = new THREE.SphereGeometry(1.6, 16, 16);
        const bodyPart2 = new THREE.Mesh(bodyPart2Geo, furMaterial);
        bodyPart2.position.set(1.5, 0, -0.5);
        bodyPart2.castShadow = true;
        bodyPart2.receiveShadow = true;
        alpaca.add(bodyPart2);

        // 2. è„–å­ (Neck)
        const neckGroup = new THREE.Group();
        neckGroup.position.set(-1.8, 1, 0); 
        alpaca.add(neckGroup);

        const neckGeo = new THREE.CylinderGeometry(0.7, 0.8, 4, 16);
        const neck = new THREE.Mesh(neckGeo, furMaterial);
        neck.position.y = 2; 
        neck.castShadow = true;
        neckGroup.add(neck);

        // 3. å¤´éƒ¨ (Head)
        const headGroup = new THREE.Group();
        headGroup.position.y = 4.2; 
        neckGroup.add(headGroup);

        const headBaseGeo = new THREE.SphereGeometry(1, 16, 16);
        const headBase = new THREE.Mesh(headBaseGeo, furMaterial);
        headBase.position.z = -0.2;
        headBase.castShadow = true;
        headGroup.add(headBase);

        const snoutGeo = new THREE.CapsuleGeometry(0.5, 0.8, 8, 16);
        const snout = new THREE.Mesh(snoutGeo, skinMaterial);
        snout.rotation.x = Math.PI / 2;
        snout.position.set(0, -0.3, 0.8);
        snout.castShadow = true;
        headGroup.add(snout);

        // çœ¼ç›
        const eyeGeo = new THREE.SphereGeometry(0.12, 8, 8);
        const eyeL = new THREE.Mesh(eyeGeo, eyeMaterial);
        eyeL.position.set(0.4, 0.2, 0.7);
        headGroup.add(eyeL);
        
        const eyeR = new THREE.Mesh(eyeGeo, eyeMaterial);
        eyeR.position.set(-0.4, 0.2, 0.7);
        headGroup.add(eyeR);

        // è€³æœµ
        const earGeo = new THREE.CapsuleGeometry(0.15, 0.8, 4, 8);
        const earL = new THREE.Mesh(earGeo, skinMaterial);
        earL.position.set(0.6, 0.8, -0.2);
        earL.rotation.z = -0.5;
        headGroup.add(earL);

        const earR = new THREE.Mesh(earGeo, skinMaterial);
        earR.position.set(-0.6, 0.8, -0.2);
        earR.rotation.z = 0.5;
        headGroup.add(earR);

        // 4. è…¿éƒ¨
        function createLeg(x, z, front) {
            const legGroup = new THREE.Group();
            legGroup.position.set(x, 0, z);

            const upperLegGeo = new THREE.CapsuleGeometry(0.4, 1.8, 8, 16);
            const upperLeg = new THREE.Mesh(upperLegGeo, furMaterial);
            upperLeg.position.y = -0.9;
            upperLeg.castShadow = true;
            legGroup.add(upperLeg);
            
            const lowerLegGeo = new THREE.CapsuleGeometry(0.35, 1.5, 8, 16);
            const lowerLeg = new THREE.Mesh(lowerLegGeo, skinMaterial);
            lowerLeg.position.y = -2.5; 
            lowerLeg.castShadow = true;
            legGroup.add(lowerLeg);

            const hoofGeo = new THREE.BoxGeometry(0.5, 0.4, 0.5);
            const hoof = new THREE.Mesh(hoofGeo, new THREE.MeshStandardMaterial({color: 0x4B372F, roughness: 0.7}));
            hoof.position.y = -3.4;
            hoof.castShadow = true;
            legGroup.add(hoof);

            return legGroup;
        }

        const legFL = createLeg(-1.2, 0.8, true); 
        const legFR = createLeg(-1.2, -0.8, true); 
        const legBL = createLeg(1.2, 0.8, false); 
        const legBR = createLeg(1.2, -0.8, false); 

        alpaca.add(legFL);
        alpaca.add(legFR);
        alpaca.add(legBL);
        alpaca.add(legBR);

        // 5. å°¾å·´
        const tailGroup = new THREE.Group();
        tailGroup.position.set(2.2, 0.8, 0);
        alpaca.add(tailGroup);

        const tailGeo = new THREE.SphereGeometry(0.6, 12, 12);
        const tail = new THREE.Mesh(tailGeo, furMaterial);
        tail.rotation.x = Math.PI / 6;
        tail.castShadow = true;
        tailGroup.add(tail);

        scene.add(alpaca);

        // --- ç¯å¢ƒ ---
        const groundGeo = new THREE.CylinderGeometry(35, 35, 80, 32);
        const groundMat = new THREE.MeshStandardMaterial({ 
            color: 0x7CFC00, 
            roughness: 0.9
        });
        const ground = new THREE.Mesh(groundGeo, groundMat);
        ground.rotation.z = Math.PI / 2;
        ground.position.y = -40; 
        ground.receiveShadow = true;
        scene.add(ground);

        // äº‘æœµ
        function createDetailedCloud(x, y, z, scale) {
            const cloudGroup = new THREE.Group();
            const mat = new THREE.MeshStandardMaterial({ color: 0xF0F8FF, roughness: 0.5 });

            const parts = [
                { radius: 1.5, x: 0, y: 0, z: 0 },
                { radius: 1.2, x: 1.2, y: 0.3, z: -0.5 },
                { radius: 1.0, x: -1.0, y: -0.2, z: 0.3 },
                { radius: 0.8, x: 0.5, y: -0.5, z: 1.0 },
                { radius: 1.3, x: -0.8, y: 0.5, z: -1.2 }
            ];

            parts.forEach(p => {
                const geo = new THREE.SphereGeometry(p.radius, 16, 16);
                const mesh = new THREE.Mesh(geo, mat);
                mesh.position.set(p.x, p.y, p.z);
                cloudGroup.add(mesh);
            });
            cloudGroup.position.set(x, y, z);
            cloudGroup.scale.set(scale, scale, scale);
            scene.add(cloudGroup);
            return cloudGroup;
        }

        const clouds = [
            createDetailedCloud(18, 15, -10, 1.8),
            createDetailedCloud(-15, 18, -15, 2.2),
            createDetailedCloud(0, 20, 10, 1.5),
            createDetailedCloud(-20, 12, 5, 2.0)
        ];

        // --- åŠ¨ç”»é€»è¾‘ ---
        const clock = new THREE.Clock();
        const runSpeed = 10;

        function animate() {
            requestAnimationFrame(animate);

            const time = clock.getElapsedTime();
            
            const legSwingAngle = Math.sin(time * runSpeed) * 0.6;
            
            legFL.rotation.x = legSwingAngle;
            legBL.rotation.x = legSwingAngle * 0.8; 
            legFL.position.y = 0.5 + Math.sin(time * runSpeed * 2) * 0.2; 

            legFR.rotation.x = legSwingAngle * -1;
            legBR.rotation.x = legSwingAngle * -0.8;
            legFR.position.y = 0.5 + Math.sin(time * runSpeed * 2 + Math.PI) * 0.2;

            alpaca.position.y = 1.0 + Math.sin(time * runSpeed * 2) * 0.15; 

            alpaca.rotation.x = Math.sin(time * runSpeed * 2) * 0.05 + 0.1;

            neckGroup.rotation.x = Math.sin(time * runSpeed + Math.PI / 2) * 0.1 - 0.2; 
            headGroup.rotation.x = Math.cos(time * runSpeed * 1.2) * 0.1; 

            tailGroup.rotation.z = Math.sin(time * runSpeed * 2.5) * 0.4;

            ground.rotation.x -= 0.03;

            clouds.forEach((cloud, index) => {
                cloud.position.x -= 0.08 * (index + 1) * 0.5;
                if (cloud.position.x < -35) {
                    cloud.position.x = 35;
                }
            });

            controls.update();
            renderer.render(scene, camera);
        }

        // éšè—åŠ è½½æ–‡å­—
        const loadingEl = document.getElementById('loading');
        if (loadingEl) loadingEl.style.display = 'none';

        // çª—å£è°ƒæ•´
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        animate();

    </script>
</body>
</html>
